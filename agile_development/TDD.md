# 测试驱动开发

TDD测试驱动开发，源于敏捷开发提出，是敏捷开发的核心实践也是一种设计方法论，在这里我们狭义的说TDD就是Unit Test Driven Development ***单元测试驱动开发*** 。

## TDD的好处

### 1. TDD不只是为了测试，更重要是驱动代码设计的过程

代码来自于需求，从代码层面来看，需求就不只是来自用户，也包括代码使用的需求。

从程序调用者的视角去观察我们编写的代码，这样我们就会关注接口。

TDD就是通过用户需求和代码使用需求，来驱动代码设计的完成。

### 2. TDD让程序易调用和可测试性

程序易调用和可测试性是非常重要的，要达到易调用和可测试，程序必须和周边环境解耦，这样TDD就迫使和验证解决我们代码中的耦合。

### 3. TDD的单元测试，就是最好的文档

TDD写出来的单元测试用例，就是对代码解释的最好的文档，且持续保持更新。

CodeReview就应该先从单元测试开始。

## 如何TDD

### 1. 单元测试先行

要实现某个功能，要编写某类、接口或函数时，要先编写测试代码，明确如何调用、如何测试；

然后在编写代码来完成功能。

### 2. 断言和桩

编写测试代码时，应该首先编写判断代码运行成功的断言，确定代码的输出。

避免对其他代码有过多的依赖，可以实现简单的桩函数或者桩类。

### 3. 及时重构

在不可单元测试的代码，有重复，结构不合理等等“坏味道”的代码，要及时进行重构。

### 4. 单元测试范围

单元测试用例应该是相互隔离的，对每一个类，每一个函数，都有独立的测试用例。 

## 总结

“也许，测试最重要的好处就是它对于架构和设计的影响。为了使一个模块或者应用程序具有可测试性，必须要对它进行解耦合。越是具有可测试性，耦合的关系就越弱。全面地考虑验收测试和单元测试的行为对于软件的结构具有深远的正面影响。”  —— 《敏捷软件开发 - 原则、模式与实践》Robert Cercil Martin 



## 附

## 设计的坏味道

- 僵化性（Rigidity）
  很难对系统进行改动，因为每个改动都会迫使许多对系统其他部分的其他改动。
- 脆弱性（Fragility）
  对系统的改动会导致系统中和改动的地方在概念上无关的许多地方出现问题。
- 牢固性（Immobility）
  很难解开系统的纠结，使之成为一些可在其他系统中重用的组件。
- 粘滞性（Viscosity）
  做正确的事情比做错误的事情要困难。
- 不必要的复杂性（Needless Complexity）
  设计中包含有不具任何直接好处的基础结构。
- 不必要的重复（Needless Repetition）
  设计中包含有重复的结构，而该重复的结构本可以使用单一的抽象进行统一。
- 晦涩性（Opacity）
  很难阅读、理解。没有很好的表现出意图。

### 面向对象设计的原则 SOLID

- 单一职责原则 The Single Responsibity Principle

  *就一个类而言，应该仅有一个引起它变化的原因。*

- 开闭原则 The Open-Close Principle

  - 对于扩展是开放的
  - 对于更改是封闭的

- Liskov替换原则 The Liskov Substitution Principle

  子类型必须能够替换掉它们的基类型。
  LSP是类与类直接继承的原则，什么时候应该使用继承，什么时候不应该使用继承。
  它反映了基类与子类之间的关系，是对开闭原则的补充。
  避免子类重写父类造成的可复用性变差的问题。
  尽量不要从可实例化的父类中继承，而是要使用基于抽象类和接口的继承。

- 依赖倒置原则 The Dependency Inversion Principle

  - 上层模块不应该依赖底层模块，它们都应该依赖于抽象

  - 抽象不应该依赖于细节，细节应该依赖于抽象

    > “针对接口编程，不针对现实编程”
    >
    > 依赖注入 

- 接口隔离原则 The Interface Segregation Principle

  - 不应该强迫客户依赖于它们不用的方法。

  - 类间的依赖关系应该建立在最小的接口上

    > 单一职责原则注重的是职责；而接口隔离原则注重对接口依赖的隔离。
    >
    > 单一职责原则主要是约束类，其次才是接口和方法，它针对的是程序中的实现和细节； 而接口隔离原则主要约束接口，主要针对抽象，针对程序整体框架的构建。





## References:

- https://en.wikipedia.org/wiki/Test-driven_development
- http://www.ibm.com/developerworks/cn/linux/l-tdd/index.html
- https://blog.csdn.net/alpha_love/article/details/75208889
- https://www.zhihu.com/question/27191817
- 《敏捷软件开发》